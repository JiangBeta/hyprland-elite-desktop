# 改进后的通知系统

## 🎯 主要改进

### 问题修复
- ✅ 解决重复恢复问题：通过状态文件跟踪，避免重复恢复相同的通知
- ✅ 改进图标显示：使用更直观的图标，避免误导
- ✅ 简化操作逻辑：更符合直觉的交互方式

### 新的操作逻辑

| 操作 | 有可见通知时 | 无可见通知但有历史时 | 无任何通知时 |
|------|------------|-------------------|-------------|
| **左键** | 关闭当前通知 | 恢复最近通知* | 无操作 |
| **中键** | 关闭当前通知 | 无操作 | 无操作 |
| **右键** | 清空所有通知 | 清空历史通知 | 无操作 |

*注：防重复恢复机制 - 只有新的历史通知才能被恢复

## 🎨 图标说明

- `󰂚 N` - 有N条当前通知（红色/活跃状态）
- `󰌐 N` - 有N条历史通知（黄色/历史状态）
- `󰄝` - 无通知（灰色/空闲状态）

## 🔧 技术实现

### 防重复恢复机制
使用状态文件 `~/.cache/mako_restore_state` 跟踪已恢复的通知数量，确保：
- 相同数量的历史通知不会被重复恢复
- 有新通知进入历史时才允许恢复
- 清空所有通知时会重置状态

### 核心脚本
1. `config/waybar/notification.sh` - 显示脚本
2. `config/waybar/notification-control.sh` - 控制脚本

## 📋 使用示例

### 典型工作流程
1. 收到通知 → 显示 `󰂚 1`
2. 左键关闭 → 通知进入历史，显示 `󰌐 1`
3. 左键恢复 → 通知重新显示，回到 `󰂚 1`
4. 再次左键恢复 → 提示"没有新的通知可恢复"（防重复）
5. 右键清空 → 完全清除，显示 `󰄝`

### 批量管理
- 多条通知时显示 `󰂚 5`
- 左键一次性关闭所有当前通知
- 右键彻底清空所有（当前+历史）

## 🧪 测试

运行测试脚本验证功能：
```bash
./test-notification-logic.sh
```

## 🎨 样式自定义

在waybar的CSS中可以自定义三种状态的样式：
- `.notification-active` - 有活跃通知
- `.notification-history` - 有历史通知
- `.notification-empty` - 无通知

## 🔄 与原系统的兼容性

保留了所有原有功能：
- 勿扰模式切换
- 中键独立操作
- Waybar信号刷新
