# Fcitx5 + Rime + 万象输入法修复记录

本文档记录了一次复杂的 fcitx5 + rime + rime_wanxiang 输入法配置问题的排查与解决过程。

## 初始问题

用户无法正常使用中文输入，表现为可以唤出输入框，但没有候选词，确认后直接输出英文字符。

## 排查过程

1.  **Lua 脚本错误**：最初的日志显示大量 `LuaProcessor` 错误，表明 Rime 的 Lua 脚本引擎未能正确加载。经查，原因是安装脚本 `setup-rime-wanxiang.sh` 在复制文件时遗漏了核心的 `rime.lua` 文件。

2.  **部署失败**：修复 `rime.lua` 丢失问题后，手动执行 `rime_deployer` 部署命令，发现大量词典编译失败的错误，如 `dictionary 'wanxiang_pro' failed to compile`。

3.  **定位根源**：错误日志显示，部署失败的原因是缺少核心词典文件，例如 `zh_dicts_pro/chars.dict.yaml`。经过对 `rime_wanxiang` GitHub 仓库的深入研究发现，该项目结构复杂，包含多个词典目录，而旧的安装脚本使用的 `find` 和 `cp` 命令未能完整复制整个项目的文件结构。

## 最终解决方案

问题的根源在于安装脚本 `setup-rime-wanxiang.sh` 的逻辑不完善，无法应对 `rime_wanxiang` 项目复杂的目录结构和依赖。

最终的修复措施是彻底重写该脚本，采用了更可靠、更健壮的逻辑：

1.  **清理旧配置**：在安装前，强制清理 Rime 目录中所有旧的、可能不完整的文件，避免干扰。

2.  **完整克隆**：使用 `git clone` 从 GitHub 下载完整的 `rime_wanxiang` 项目。

3.  **验证完整性**：在下载后，脚本会检查 `zh_dicts_pro`, `lookup`, `lua` 等关键的目录是否存在，确保下载内容的完整性。

4.  **精确同步**：使用 `rsync -a` 命令进行文件同步。`rsync` 的归档模式 `-a` 能确保所有文件、目录、权限和链接都**原封不动地**被复制到 Rime 配置目录，完美解决了文件缺失的问题。

5.  **部署与检查**：脚本在同步文件后，会自动执行 `rime_deployer` 命令来编译和部署词库，并捕获其输出，方便判断部署是否成功。

通过以上步骤，保证了 Rime 拥有了完整且正确的配置文件和词库，输入法最终恢复正常。
